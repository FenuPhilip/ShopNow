{% extends 'base.html' %}
{% block title %}All Products — ShopNow{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row">
    <!-- Sidebar Filters -->
    <div class="col-lg-3 mb-4">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h5 class="fw-bold mb-3"><i class="bi bi-funnel me-2"></i>Filters</h5>

          <!-- Category -->
          <h6 class="fw-semibold text-muted text-uppercase small mb-2">Category</h6>
          <ul class="list-unstyled mb-3">
            <li><a href="{% url 'product_list' %}" class="text-decoration-none text-dark d-block py-1">All Categories</a></li>
            {% for cat in categories %}
            <li>
              <a href="?category={{ cat.slug }}" class="text-decoration-none d-block py-1 {% if request.GET.category == cat.slug %}fw-bold text-warning{% else %}text-dark{% endif %}">
                {{ cat.name }}
                <span class="badge bg-light text-dark float-end">{{ cat.products.count }}</span>
              </a>
            </li>
            {% endfor %}
          </ul>

          <!-- Brand -->
          {% if brands %}
          <h6 class="fw-semibold text-muted text-uppercase small mb-2">Brand</h6>
          <ul class="list-unstyled mb-3">
            {% for brand in brands %}
            <li>
              <a href="?brand={{ brand.slug }}" class="text-decoration-none d-block py-1 {% if request.GET.brand == brand.slug %}fw-bold text-warning{% else %}text-dark{% endif %}">
                {{ brand.name }}
              </a>
            </li>
            {% endfor %}
          </ul>
          {% endif %}

          <!-- Price Range -->
          <h6 class="fw-semibold text-muted text-uppercase small mb-2">Price Range</h6>
          <form method="GET">
            {% if request.GET.category %}<input type="hidden" name="category" value="{{ request.GET.category }}">{% endif %}
            <div class="row g-2 mb-3">
              <div class="col-6">
                <input type="number" name="min_price" class="form-control form-control-sm" placeholder="Min ₹" value="{{ request.GET.min_price }}">
              </div>
              <div class="col-6">
                <input type="number" name="max_price" class="form-control form-control-sm" placeholder="Max ₹" value="{{ request.GET.max_price }}">
              </div>
            </div>
            <button type="submit" class="btn btn-dark btn-sm w-100">Apply Filter</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="col-lg-9">
      <!-- Toolbar -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <p class="mb-0 text-muted">Showing <strong>{{ total_count }}</strong> products</p>
        <div class="d-flex align-items-center gap-2">
          <!-- Search -->
          <form method="GET" class="d-flex">
            <input type="text" name="q" class="form-control form-control-sm" placeholder="Search..." value="{{ request.GET.q }}">
            <button class="btn btn-dark btn-sm ms-1"><i class="bi bi-search"></i></button>
          </form>
          <!-- Sort -->
          <select class="form-select form-select-sm" style="width:auto;" onchange="window.location='?sort='+this.value">
            <option value="newest" {% if current_sort == 'newest' %}selected{% endif %}>Newest</option>
            <option value="price_asc" {% if current_sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
            <option value="price_desc" {% if current_sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
            <option value="name_asc" {% if current_sort == 'name_asc' %}selected{% endif %}>Name A-Z</option>
          </select>
        </div>
      </div>

      {% if page_obj %}
      <div class="row g-4">
        {% for product in page_obj %}
        {% include 'store/partials/product_card.html' %}
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if page_obj.has_other_pages %}
      <nav class="mt-5">
        <ul class="pagination justify-content-center">
          {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
          {% endif %}
          {% for num in page_obj.paginator.page_range %}
          <li class="page-item {% if page_obj.number == num %}active{% endif %}">
            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
          </li>
          {% endfor %}
          {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}

      {% else %}
      <div class="text-center py-5">
        <i class="bi bi-search text-muted" style="font-size:4rem;"></i>
        <h4 class="mt-3">No products found</h4>
        <p class="text-muted">Try different filters or search terms.</p>
        <a href="{% url 'product_list' %}" class="btn btn-dark">Clear Filters</a>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
