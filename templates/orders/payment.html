{% extends 'base.html' %}
{% block title %}Payment — ShopNow{% endblock %}
{% block content %}
<div class="container py-5">
  <h2 class="fw-bold mb-4"><i class="bi bi-credit-card me-2"></i>Payment</h2>

  <!-- Progress -->
  <div class="d-flex align-items-center mb-5">
    <div class="text-success fw-bold"><i class="bi bi-check-circle-fill me-1"></i>Shipping</div>
    <div class="flex-grow-1 border-top mx-3"></div>
    <div class="text-warning fw-bold">2. Payment</div>
    <div class="flex-grow-1 border-top mx-3"></div>
    <div class="text-muted">3. Confirmation</div>
  </div>

  <div class="row g-4">
    <div class="col-lg-7">
      <!-- Delivery Address Summary -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <h6 class="fw-bold">Deliver to</h6>
            <a href="{% url 'checkout' %}" class="btn btn-sm btn-outline-secondary">Change</a>
          </div>
          <p class="mb-0 text-muted">
            {{ checkout_data.shipping_name }} — 
            {{ checkout_data.address_line1 }}, {{ checkout_data.city }}, {{ checkout_data.state }} {{ checkout_data.postal_code }}
          </p>
        </div>
      </div>

      <!-- Payment Method -->
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <h5 class="fw-bold mb-3">Select Payment Method</h5>
          <form method="POST">
            {% csrf_token %}
            {% for choice in form.payment_method %}
            <div class="form-check border rounded p-3 mb-2">
              {{ choice.tag }}
              <label class="form-check-label ms-2 fw-semibold" for="{{ choice.id_for_label }}">
                {{ choice.choice_label }}
              </label>
            </div>
            {% endfor %}
            {% if form.payment_method.errors %}
            <div class="text-danger small">{{ form.payment_method.errors }}</div>
            {% endif %}
            <button type="submit" class="btn btn-warning btn-lg w-100 mt-4 fw-bold">
              <i class="bi bi-lock-fill me-2"></i>Place Order — ₹{{ total }}
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Summary -->
    <div class="col-lg-5">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h5 class="fw-bold mb-3">Order Summary</h5>
          {% for item in cart.items.all %}
          <div class="d-flex align-items-center gap-2 mb-2">
            <div class="flex-grow-1">
              <span class="fw-semibold">{{ item.product.name }}</span>
              <small class="text-muted"> × {{ item.quantity }}</small>
            </div>
            <span>₹{{ item.line_total }}</span>
          </div>
          {% endfor %}
          <hr>
          <div class="d-flex justify-content-between"><span class="text-muted">Subtotal</span><span>₹{{ cart.subtotal }}</span></div>
          {% if discount %}<div class="d-flex justify-content-between text-success"><span>Discount</span><span>-₹{{ discount }}</span></div>{% endif %}
          <div class="d-flex justify-content-between"><span class="text-muted">Shipping</span><span class="text-success">Free</span></div>
          <hr>
          <div class="d-flex justify-content-between fw-bold fs-5"><span>Total</span><span class="text-warning">₹{{ total }}</span></div>
          <div class="mt-3 text-center">
            <small class="text-muted"><i class="bi bi-shield-lock me-1"></i>256-bit SSL encrypted checkout</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
